"use strict";function getSlotCategories(a){displayLoadingSpinner(),jQuery.ajax({method:"GET",headers:{"X-API-Key":a,"X-API-Version":1},url:"https://djpsoftware.azurewebsites.net/api/slotcategories",dataType:"json"}).done((function(a){setup(a)})).fail((function(){setupFailed()}))}function checkAvailability(){let a=document.getElementsByClassName("availability-wrapper")[0].dataset.customerId,e=jQuery(".availability-wrapper #selected-start-date").val(),t=jQuery(".availability-wrapper #selected-end-date").val();slotCategory().then((i=>{let l="";switch(i.availabilityDateConfig){case"EndDate":case"EndDateTime":""==t&&(l=`Please complete '${i.endLabel??"date field"}' before checking availability`);break;case"StartDate":case"StartDateTime":""==e&&(l=`Please complete '${i.startLabel??"date field"}' before checking availability`);break;case"StartEndDate":case"StartEndDateTime":""!=e&&""!=t||(l=`Please complete '${i.startLabel??"date field 1"}' and '${i.endLabel??"date field 2"}' before checking availability`)}""==l?getAvailability(a):alert(l)}))}function getSlotCategoryName(){let a=jQuery(".availability-wrapper")[0]?document.getElementsByClassName("availability-wrapper")[0].dataset.category:"",e="";return async function(){return""!=e||(e="getCategoryAsync"==a?getCategoryAsync().then((a=>a),setupFailed):a),e}}jQuery(document).ready((function(){if(jQuery(".availability-wrapper").length){let a=document.getElementsByClassName("availability-wrapper")[0].dataset.customerId;jQuery(".availability-wrapper").append('<div class="feedback-wrapper mt-3"></div>'),getSlotCategories(a)}}));let slotCategory,slotCategoryName=getSlotCategoryName();function getSlotCategory(a){let e;return async function(){if(void 0!==e)return e;{let t=await slotCategoryName();return e=a.find((a=>a.slotCategory==t)),e}}}function getAvailability(a){displayLoadingSpinner();let e=jQuery(".availability-wrapper #selected-start-date").val(),t=jQuery(".availability-wrapper #selected-end-date").val();slotCategory().then((i=>{let l="";switch(i.availabilityDateConfig){case"EndDate":case"EndDateTime":l=`endDate=${t}`;break;case"StartDate":case"StartDateTime":l=`startDate=${e}`;break;case"StartEndDate":case"StartEndDateTime":l=`startDate=${e}&endDate=${t}`}let n=`https://djpsoftware.azurewebsites.net/api/data/availability?${l}&slotCategory=${i.slotCategory}`;jQuery.ajax({method:"GET",headers:{"X-API-Key":a,"X-API-Version":1},url:n,dataType:"json"}).done((function(a){displayAvailability(a)})).fail((function(){availabilityFailed()}))}))}function setup(a){removeLoadingSpinner(),slotCategory=getSlotCategory(a),slotCategory().then((a=>{if(void 0!==a&&a.enabled){let e=`Note that we require at least ${a.leadTimeDays} days notice. Bookings can be a maximum of ${a.advanceBookingLimitDays} days ahead`,t=document.getElementsByClassName("availability-wrapper")[0].dataset.additionalButtonName,i=a.availabilityDateConfig.includes("Time"),l=i?"datetime-local":"date",n="",r=`<div><label class="d-block" for="selected-start-date">${a.startLabel??""}</label><input id="selected-start-date" type="${l}" onchange="removeDataPlusFeedback()" min="${getCurrentDate(i)}" max="${getMaxDate(a.advanceBookingLimitDays,i)}"  /></div>`,s=`<div><label class="d-block" for="selected-end-date">${a.endLabel??""}</label><input id="selected-end-date" type="${l}" onchange="removeDataPlusFeedback()" min="${getCurrentDate(i)}" max="${getMaxDate(a.advanceBookingLimitDays,i)}"  /></div>`,o='<button id="check-availability" class="btn btn-primary" type="button" onclick="checkAvailability()">Check Availability</button>',c=void 0!==t?`<button id="${replaceWhiteSpace(t.toLowerCase()," ","-")}" class="btn btn-primary" type="button">${t}</button>`:"";switch(a.availabilityDateConfig){case"EndDate":case"EndDateTime":n=`${s}`;break;case"StartDate":case"StartDateTime":n=`${r}`;break;case"StartEndDate":case"StartEndDateTime":n=`${r}${s}`}jQuery(`<label class="mb-2" for="check-availability">${e}</label><div class="availability-input-wrapper">${n}${o}${c}</div>`).insertBefore(".availability-wrapper .feedback-wrapper")}else setupFailed()}))}function appendFailedMessage(a){let e=document.getElementsByClassName("availability-wrapper")[0].dataset.contactUrl,t="";t=void 0!==e?`<i class="fas fa-exclamation-circle"></i><p class="ms-1">${a}. Please try again later or contact us <a href="${e}" target="_blank">here</a> for assistance</p>`:`<i class="fas fa-exclamation-circle"></i><p class="ms-1">${a}. Please try again later or contact us for assistance</p>`,removeFeedback(),jQuery(".availability-wrapper .feedback-wrapper").append(`<div class="d-flex">${t}</div>`)}function setupFailed(){removeLoadingSpinner(),appendFailedMessage("Unable to start availability calendar")}function displayAvailability(a){removeLoadingSpinner(),storeData(a),slotCategory().then((e=>{let t="";switch(e.availabilityDateConfig){case"EndDate":case"EndDateTime":t=`The next available date is ${a.nextAvailableEndDate}`;break;case"StartDate":case"StartDateTime":t=`The next available date is ${a.nextAvailableStartDate}`;break;case"StartEndDate":case"StartEndDateTime":t=`The next available dates are ${a.nextAvailableStartDate} and ${a.nextAvailableEndDate}`}let i="";i=a.available?'<i class="fas fa-check-circle"></i><p class="ms-1">This date is available</p>':`<i class="fas fa-exclamation-circle"></i><p class="ms-1">This date is not available. ${t}</p>`,removeFeedback(),jQuery(".availability-wrapper .feedback-wrapper").append(`<div class="d-flex">${i}</div>`)}))}function availabilityFailed(){removeLoadingSpinner(),appendFailedMessage("Unable to access availability data")}function removeDataPlusFeedback(){removeData(),removeFeedback()}function removeData(){sessionStorage.removeItem("djps_availability")}function storeData(a){sessionStorage.setItem("djps_availability",JSON.stringify(a))}function replaceWhiteSpace(a,e,t){return a.split(e).join(t)}function removeFeedback(){jQuery(".availability-wrapper .feedback-wrapper").empty()}function displayLoadingSpinner(){removeFeedback(),jQuery(".availability-wrapper .feedback-wrapper").addClass("fas fa-sync fa-spin")}function removeLoadingSpinner(){jQuery(".availability-wrapper .feedback-wrapper").removeClass("fas fa-sync fa-spin")}function getCurrentDate(a){let e=(new Date).toISOString();return a?e.substring(0,16):e.substring(0,10)}function getMaxDate(a,e){let t=new Date;t.setDate(t.getDate()+a);let i=new Date(t).toISOString();return e?i.substring(0,16):i.substring(0,10)}